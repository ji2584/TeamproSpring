<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "cart">
<insert id="addToAproducts" parameterType="cart">
    INSERT INTO Aproducts (ser, id, pnum) 
    values (Aproduct.nextval, #{id}, #{pnum})
</insert>

<select id="jumunList" parameterType="map" resultType="Auction">
SELECT 
        a.pnum, a.buy, a.idate,a.prompt, a.pname, a.file1, a.subject, a.price, a.readcnt, TO_CHAR(a.regdate, 'yyyy-MM-dd HH24:mi:ss') AS regdate
    FROM 
        amem m
    JOIN 
        aproducts ap ON m.id = ap.id
    JOIN 
        auction a ON ap.pnum = a.pnum
    WHERE 
        m.id = #{id}
    ORDER BY 
    a.pnum DESC
</select>

   <select id="myList" parameterType="map" resultType="Auction">
      SELECT
            b.userid,
            b.pnum,
            b.prompt,
            b.pname,
            b.file1,
            b.subject,
            b.price,
            b.readcnt,
            TO_CHAR(b.regdate, 'yyyy-MM-dd HH24:mi:ss') AS regdate
        FROM
            amem a
        JOIN
            auction b ON a.id = b.userid
        WHERE 
            a.id = #{loggedInUserId}
        ORDER BY 
            b.pnum DESC
    </select>

<delete id="jumunDelete"  parameterType="int">
delete from aproducts where pnum = #{pnum}
</delete> 

<select id="Tier" parameterType="string" resultType="String">
 SELECT Tier FROM
    (
        SELECT
            SUM(BUY) as total_AMOUNT,
            CASE
                WHEN SUM(BUY) &lt; 10000 THEN 'Silver'
                WHEN SUM(BUY) BETWEEN 50000 AND 100000 THEN 'Gold'
                WHEN SUM(BUY) BETWEEN 100001 AND 300000 THEN 'Platinum'
                ELSE 'Diamond'
            END AS Tier
        FROM
            auction
        WHERE
            BUYID = #{BUYID}
        GROUP BY
           BUYID
    ) 
    </select>
    
    

   
</mapper>
















